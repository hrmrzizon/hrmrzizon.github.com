---
layout: post
author: "Su-Hyeok Kim"
comments: true
categories:
    - unity
    - texture_compression
    - analysis
---

모든 내용은 전부 Jacob Ström 홈페이지의 자료등을 참고했습니다.([http://www.jacobstrom.com/output.html](http://www.jacobstrom.com/output.html))

## 3\. ETC2

ETC2 는 ETC 에서 블록의 모드를 더 추가해 다양한 방식으로 표현할 수 있는 텍스쳐 압축 방식이다. 다른 압축 방식들에서는 잉여 공간을 활용해 다른 데이터의 표현 수단으로 사용한 것을 보고, 고안해낸 사람은 ETC 에서도 같은 방식으로 잉여 공간을 찾아 활용할 계획을 한것 같다. 남는 공간은 없었지만 유효하지 않은(invalid) 비트 공간을 활용해 노말 모드, 동차(difference) 모드 외에도 세가지의 표현 방식을 추가했다.
<!-- more -->
#### (1) 유효하지 않은 비트 공간이란?

ETC 에서 동차(difference) 모드는 서브블록의 색 공간을 합쳐서 활용하여 RGB555+dRGB333 으로 색을 표현했다. 여기서 유효하지 않은 비트 공간을 일부로 만들 수 있다. 바로 각자 색 성분이 합쳐져 0미만으로 언더 플로우가 나게하거나, 32 이상으로 만들어 오버플로우를(RGB555) 줘서 신호를 주는 것이다. 그렇게 RGB 세 성분을 유효하지 않게 만들어 3가지의 모드를 확보한다. ETC2 는 이 3가지 모드를 보조(auxiliary) 모드라고 칭한다. 아래 그림은 모드를 선택하는 다이어그램이다.

| ![diagram](/images/etc2_invalid_bit_diagram.png) |
| :---: |
| ETC2 의 모드 선택 다이어그램 |
| |

위 그림에서 오버플로우, 언더플로우가 생길 떄 보조 모드에서 55bit 가 남는다고 쓰여있다. diffbit 을 사용하는 1bit, 색상의 빨간색 컴포넌트 R0, dR 두개를 합치면 8bit 로 63bit 에서 값을 빼서 구한 값이다. 사실 55bit 가 아닌 59bit 를 사용가능하다.

오버플로우, 언더플로우가 생기는 모든 케이스가 아래 표에 표현되어 있다. 데이터를 이진수로 보면 R0, dR 컴포넌트의 맨 마지막

| ![diagram](/images/etc2_overflow_bit_table.png) |
| :---: |
| ETC2 의 invalid 한 색상 테이블 |
| |

RGB555+dRGB333 색 조합 오버,언더플로우 방식으로 특이점을 주어 59, 58, 57 의 페이로드를 확보함.
근데 왜 아직도 1bit 씩 공간이 필요한지 모르겠음. 그리고 디스크에 기록할때 4bit 로 줄여서 기록하면 그 줄어든 데이터는 어케 알아봄??;

이렇게 새로운 모드를 구별 가능한데, 이전의 ETC 텍스쳐 데이터를 ETC2 디코더가 읽어도 오버,언더플로우가 나지 않기 때문에 이전 버젼의 텍스쳐를 읽어도 정상적으로 표현이 가능하다. 즉 ETC2는 ETC 의 하위 호환을 지원한다는 말이다.

#### (2) 추가된 세가지 모드

###### (1) T 모드
###### (2) H 모드
###### (3) planar 모드

#### (3) 특징

ETC2 는 OpenGL ES 3.0 이상에서만 사용가능하기 때문에 ES 3.0 을 지원하지 않으면 아예 쓸 수가 없다. 요즈음 모바일 기기들은 꽤 발전하긴 하지만 아직 많이 남아있는 기기들이 OpenGL ES 2.X 버젼까지만 지원한다.
